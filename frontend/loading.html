<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoLens â€” Analyzing...</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="../css/style.css" rel="stylesheet">
</head>
<body>

<nav>
  <a href="home.html" class="logo">Auto<span>Lens</span></a>
</nav>

<div class="main">
  <div class="bg-text">SCAN</div>

  <div class="scanner-ring">
    <div class="ring ring-1"></div>
    <div class="ring ring-2"></div>
    <div class="ring ring-3"></div>
    <div class="ring-center">ğŸš—</div>
  </div>

  <div class="analyzing-text">
    <h1>AI is <span>Analyzing</span></h1>
    <div class="step-text" id="stepText">Initializing extraction engine...</div>
  </div>

  <div class="pipeline" id="pipeline">
    <div class="pipe-step active" id="step-extract">
      <div class="pipe-icon">ğŸ¤–</div>
      <div class="pipe-label">AI Extraction</div>
      <div class="pipe-status" id="s1">parsing listing...</div>
    </div>
  
    </div>
    <div class="pipe-step" id="step-recall">
      <div class="pipe-icon">ğŸ””</div>
      <div class="pipe-label">Recall Check</div>
      <div class="pipe-status" id="s3">pending</div>
    </div>
    <div class="pipe-step" id="step-price">
      <div class="pipe-icon">ğŸ’°</div>
      <div class="pipe-label">Price Analysis</div>
      <div class="pipe-status" id="s4">pending</div>
    </div>
    <div class="pipe-step" id="step-risk">
      <div class="pipe-icon">âš ï¸</div>
      <div class="pipe-label">Risk Scoring</div>
      <div class="pipe-status" id="s5">pending</div>
    </div>
  </div>

  <div class="progress-outer">
    <div class="progress-inner" id="progressBar"></div>
  </div>
  <div class="progress-pct" id="pct">0%</div>

  <div class="log-terminal" id="logTerminal">
    <div class="log-line">> AutoLens v2.1 initialized</div>
    <div class="log-line">> Input received: paste text mode</div>
    <div class="log-line">> Starting AI extraction pipeline...</div>
  </div>
</div>

<script>
  const steps = [
    { id: 'step-extract', status: 's1', text: 'Extracting fields with AI...', log: ['> Sending to language model...', '> Fields identified: year, make, model, VIN, price, mileage'], done: 'structured', progress: 20 },
    { id: 'step-recall', status: 's3', text: 'Checking NHTSA recall database...', log: ['> Querying recalls for VIN...', '> Found 2 open recall(s)', '> NHTSA Campaign: 21V-xxx â€” Airbag inflator'], done: '2 recalls', progress: 60 },
    { id: 'step-price', status: 's4', text: 'Estimating fair market price...', log: ['> Analyzing year, mileage, trim...', '> Market comp range: $16,800 â€“ $19,200', '> Listed at $18,500 â†’ within range'], done: 'fair', progress: 80 },
    { id: 'step-risk', status: 's5', text: 'Calculating risk score...', log: ['> Scanning for red flags...', '> Title status: clean âœ“', '> Accident claims: none stated', '> Open recalls: flagged âš '], done: 'scored', progress: 100 },
  ];

  let current = 0;

  function runStep(i) {
    if (i >= steps.length) {
      setTimeout(() => window.location.href = 'results.html', 800);
      return;
    }

    const step = steps[i];

    // Mark previous done
    if (i > 0) {
      document.getElementById(steps[i - 1].id).classList.remove('active');
      document.getElementById(steps[i - 1].id).classList.add('done');
    }

    // Mark current active
    const el = document.getElementById(step.id);
    el.classList.add('active');

    // Update step text
    document.getElementById('stepText').textContent = step.text;
    document.getElementById(step.status).textContent = 'processing...';

    // Progress
    document.getElementById('progressBar').style.width = step.progress + '%';
    document.getElementById('pct').textContent = step.progress + '%';

    // Log
    const log = document.getElementById('logTerminal');
    step.log.forEach((line, idx) => {
      setTimeout(() => {
        const div = document.createElement('div');
        div.className = 'log-line' + (line.includes('recall') || line.includes('âš ') ? ' warn' : line.includes('âœ“') || line.includes('Response') ? ' ok' : '');
        div.textContent = line;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      }, idx * 400);
    });

    setTimeout(() => {
      document.getElementById(step.status).textContent = step.done;
      runStep(i + 1);
    }, step.log.length * 400 + 600);
  }

  setTimeout(() => runStep(0), 600);
</script>

</body>
</html>
